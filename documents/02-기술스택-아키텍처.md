# ğŸ›  ê¸°ìˆ  ìŠ¤íƒ ë° ì•„í‚¤í…ì²˜

## 1. ê¸°ìˆ  ìŠ¤íƒ ê°œìš”

### Frontend

```
â”œâ”€â”€ Framework: Next.js 15.5.7 (App Router)
â”œâ”€â”€ Language: JavaScript (ES6+)
â”œâ”€â”€ UI Library: React 19.2.1
â”œâ”€â”€ Styling: TailwindCSS v4
â”œâ”€â”€ State Management: React Context API
â””â”€â”€ HTTP Client: Axios 1.12.2
```

### Backend

```
â”œâ”€â”€ Runtime: Node.js
â”œâ”€â”€ Framework: Next.js API Routes
â”œâ”€â”€ ORM: Prisma 6.17.0
â”œâ”€â”€ Database: PostgreSQL (Supabase)
â”œâ”€â”€ Authentication: Supabase Auth
â””â”€â”€ Storage: Supabase Storage
```

### External Services

```
â”œâ”€â”€ Email Service: Gmail SMTP / MailPlug SMTP
â”œâ”€â”€ Email Reception: POP3 / IMAP
â”œâ”€â”€ OAuth Providers: Google, Instagram
â””â”€â”€ Development: ngrok (HTTPS tunneling)
```

## 2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 2.1 ì „ì²´ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Client (Browser)                      â”‚
â”‚                    React + TailwindCSS                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                       â”‚
                   â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Next.js App Router    â”‚   â”‚      Supabase Auth       â”‚
â”‚    (Pages & Layouts)     â”‚   â”‚    (Google OAuth)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                             â”‚
             â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Routes Layer                       â”‚
â”‚     /api/users  /api/emails  /api/influencers  etc.     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                     â–¼             â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Prisma ORM   â”‚   â”‚   Supabase   â”‚  â”‚   SMTP   â”‚  â”‚Instagram  â”‚
â”‚               â”‚   â”‚   Storage    â”‚  â”‚ Services â”‚  â”‚    API    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PostgreSQL Database                    â”‚
â”‚                    (Supabase Hosted)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ì¸ì¦ í”Œë¡œìš°

```
ì‚¬ìš©ì â†’ Google ë¡œê·¸ì¸ â†’ Supabase Auth
         â†“
         OAuth í† í° ë°œê¸‰
         â†“
         Supabase Session ìƒì„±
         â†“
         Middleware ì¸ì¦ í™•ì¸
         â†“
         DB User ë ˆì½”ë“œ ìƒì„±/ì—…ë°ì´íŠ¸ (/api/users)
         â†“
         AuthProvider Context ì—…ë°ì´íŠ¸
         â†“
         ì¸ì¦ëœ ì‚¬ìš©ìë¡œ ì•± ì ‘ê·¼
```

### 2.3 ë°ì´í„° í”Œë¡œìš°

```
1. ì¸í”Œë£¨ì–¸ì„œ ë°ì´í„° ìˆ˜ì§‘
   Instagram API â†’ /api/instagram/callback â†’ Prisma â†’ PostgreSQL

2. ì´ë©”ì¼ ë°œì†¡
   í…œí”Œë¦¿ + ì¸í”Œë£¨ì–¸ì„œ ë°ì´í„° â†’ ë³€ìˆ˜ ì¹˜í™˜ â†’ SMTP ë°œì†¡ â†’ ë¡œê·¸ ì €ì¥

3. íŒŒì¼ ì—…ë¡œë“œ
   Client â†’ /api/upload â†’ Supabase Storage â†’ Public URL ìƒì„±
```

## 3. í´ë” êµ¬ì¡°

```
instacrawl/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ api/                      # API Routes
â”‚   â”‚   â”œâ”€â”€ users/               # ì‚¬ìš©ì ê´€ë¦¬ API
â”‚   â”‚   â”œâ”€â”€ influencers/         # ì¸í”Œë£¨ì–¸ì„œ CRUD API
â”‚   â”‚   â”œâ”€â”€ email-templates/     # í…œí”Œë¦¿ ê´€ë¦¬ API
â”‚   â”‚   â”œâ”€â”€ emails/              # ì´ë©”ì¼ ë°œì†¡/ìˆ˜ì‹  API
â”‚   â”‚   â”œâ”€â”€ instagram/           # Instagram OAuth API(ì‚¬ìš©í•˜ì§€ì•ŠìŒ)
â”‚   â”‚   â”œâ”€â”€ survey/              # ìº í˜ì¸(ì„¤ë¬¸ì¡°ì‚¬) API
â”‚   â”‚   â””â”€â”€ upload/              # íŒŒì¼ ì—…ë¡œë“œ API
â”‚   â”‚
â”‚   â”œâ”€â”€ dashboard/               # ëŒ€ì‹œë³´ë“œ í˜ì´ì§€
â”‚   â”œâ”€â”€ influencer-management/   # ì¸í”Œë£¨ì–¸ì„œ ê´€ë¦¬ í˜ì´ì§€
â”‚   â”œâ”€â”€ email-templates/         # í…œí”Œë¦¿ ê´€ë¦¬ í˜ì´ì§€
â”‚   â”œâ”€â”€ email-compose/           # ì´ë©”ì¼ ì‘ì„± í˜ì´ì§€
â”‚   â”œâ”€â”€ inbox/                   # ìˆ˜ì‹ í•¨ í˜ì´ì§€
â”‚   â”œâ”€â”€ settings/                # ì„¤ì • í˜ì´ì§€
â”‚   â”œâ”€â”€ survey-templates/        # ì„¤ë¬¸ ê´€ë¦¬ í˜ì´ì§€
â”‚   â”œâ”€â”€ login/                   # ë¡œê·¸ì¸ í˜ì´ì§€
â”‚   â”œâ”€â”€ layout.js               # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ
â”‚   â”œâ”€â”€ page.js                  # í™ˆí˜ì´ì§€
â”‚   â””â”€â”€ globals.css
â”‚
â”œâ”€â”€ components/                   # React ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ AuthProvider.js          # ì¸ì¦ Context Provider
â”‚   â”œâ”€â”€ Navigation.js            # ë„¤ë¹„ê²Œì´ì…˜ ë°”
â”‚   â”œâ”€â”€ LoadingSpinner.js        # ë¡œë”© ìŠ¤í”¼ë„ˆ
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ lib/                          # ìœ í‹¸ë¦¬í‹° ë° í—¬í¼
â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”œâ”€â”€ client.js            # Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
â”‚   â”‚   â””â”€â”€ server.js            # Supabase ì„œë²„ ì„¤ì •
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ authHelpers.js       # ì¸ì¦ í—¬í¼ í•¨ìˆ˜
â”‚   â”œâ”€â”€ prisma.js                # Prisma í´ë¼ì´ì–¸íŠ¸ ì‹±ê¸€í†¤
â”‚   â”œâ”€â”€ emailProviders.js        # ì´ë©”ì¼ í”„ë¡œë°”ì´ë” ì„¤ì •
â”‚   â”œâ”€â”€ mailplug.js              # MailPlug ì „ìš© í•¨ìˆ˜
â”‚   â””â”€â”€ userService.js           # ì‚¬ìš©ì ê´€ë ¨ ì„œë¹„ìŠ¤
â”‚
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma            # ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
â”‚
â”œâ”€â”€ app/generated/prisma/         # Prisma í´ë¼ì´ì–¸íŠ¸ (ìë™ ìƒì„±)
â”‚
â”œâ”€â”€ public/                       # ì •ì  íŒŒì¼
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ icons/
â”‚
â”œâ”€â”€ documents/                    # í”„ë¡œì íŠ¸ ë¬¸ì„œ
â”‚
â”œâ”€â”€ scripts/                      # ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸
â”‚
â”œâ”€â”€ .env                         # í™˜ê²½ ë³€ìˆ˜
â”œâ”€â”€ package.json                 # ì˜ì¡´ì„± ê´€ë¦¬
â”œâ”€â”€ next.config.mjs              # Next.js ì„¤ì •
â”œâ”€â”€ postcss.config.mjs           # PostCSS ì„¤ì •
â”œâ”€â”€ jsconfig.json                # JavaScript ì„¤ì •
â””â”€â”€ middleware.js                # Next.js ë¯¸ë“¤ì›¨ì–´
```

## 4. í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ì„¤ëª…

### 4.1 Frontend ì»´í¬ë„ŒíŠ¸

#### AuthProvider (`components/AuthProvider.js`)

```javascript
// ì£¼ìš” ê¸°ëŠ¥:
- Supabase ì„¸ì…˜ ê´€ë¦¬
- ì‚¬ìš©ì ì •ë³´ Context ì œê³µ
- ìë™ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
- DB ì‚¬ìš©ì ë™ê¸°í™”
```

#### Navigation (`components/Navigation.js`)

```javascript
// ì£¼ìš” ê¸°ëŠ¥:
- ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜
- í™œì„± ë©”ë‰´ í•˜ì´ë¼ì´íŠ¸
- ì‚¬ìš©ì í”„ë¡œí•„ í‘œì‹œ
- ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥
```

### 4.2 API Routes êµ¬ì¡°

#### `/api/users/route.js`

```javascript
// ì—”ë“œí¬ì¸íŠ¸:
GET / api / users; // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
POST / api / users; // ì‹ ê·œ ì‚¬ìš©ì ìƒì„±
PUT / api / users; // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
```

#### `/api/emails/send/route.js`

```javascript
// ì—”ë“œí¬ì¸íŠ¸:
POST   /api/emails/send    // ì´ë©”ì¼ ë°œì†¡

// ìš”ì²­ ë³¸ë¬¸:
{
  templateId: number,
  influencerIds: number[],
  userVariables?: object
}
```

#### `/api/influencers/route.js`

```javascript
// ì—”ë“œí¬ì¸íŠ¸:
GET / api / influencers; // ì¸í”Œë£¨ì–¸ì„œ ëª©ë¡ ì¡°íšŒ
POST / api / influencers; // ì¸í”Œë£¨ì–¸ì„œ ìƒì„±
PUT / api / influencers; // ì¸í”Œë£¨ì–¸ì„œ ìˆ˜ì •
DELETE / api / influencers; // ì¸í”Œë£¨ì–¸ì„œ ì‚­ì œ
```

### 4.3 ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°

#### Prisma ì„¤ì • (`lib/prisma.js`)

```javascript
import { PrismaClient } from "@/app/generated/prisma";

const globalForPrisma = global;

export const prisma = globalForPrisma.prisma || new PrismaClient();

if (process.env.NODE_ENV !== "production") globalForPrisma.prisma = prisma;
```

## 5. ì£¼ìš” ì„¤ê³„ íŒ¨í„´

### 5.1 ì‹±ê¸€í†¤ íŒ¨í„´

- **Prisma Client**: ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ë¡œ DB ì—°ê²° ê´€ë¦¬
- **Supabase Client**: í´ë¼ì´ì–¸íŠ¸/ì„œë²„ë³„ ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤

### 5.2 Provider íŒ¨í„´

- **AuthProvider**: ì¸ì¦ ìƒíƒœ ì „ì—­ ê´€ë¦¬
- **Context API**: ìƒíƒœ ê´€ë¦¬ ë° ê³µìœ 

### 5.3 ë¯¸ë“¤ì›¨ì–´ íŒ¨í„´

- **Next.js Middleware**: ë¼ìš°íŠ¸ ë³´í˜¸ ë° ì¸ì¦ ê²€ì¦
- **API Route Handler**: ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬ í‘œì¤€í™”

### 5.4 Factory íŒ¨í„´

- **Email Provider Factory**: Gmail/MailPlug í”„ë¡œë°”ì´ë” ë™ì  ìƒì„±

## 6. ë³´ì•ˆ ì•„í‚¤í…ì²˜

### 6.1 ì¸ì¦ ë° ì¸ê°€

```
- Supabase Authë¥¼ í†µí•œ ì¤‘ì•™ì§‘ì¤‘ì‹ ì¸ì¦
- JWT í† í° ê¸°ë°˜ ì„¸ì…˜ ê´€ë¦¬
- ë¯¸ë“¤ì›¨ì–´ë¥¼ í†µí•œ ë¼ìš°íŠ¸ ë³´í˜¸
- API Routesì—ì„œ ì„¸ì…˜ ê²€ì¦
```

### 6.2 ë°ì´í„° ë³´ì•ˆ

```
- í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•œ ë¯¼ê° ì •ë³´ ê´€ë¦¬
- HTTPS ì „ìš© í†µì‹  (Production)
- Supabase RLS (Row Level Security) ê³ ë ¤
- SQL Injection ë°©ì§€ (Prisma ORM)
```

### 6.3 CORS ì„¤ì •

```javascript
// next.config.mjs
headers: async () => [
  {
    source: "/api/:path*",
    headers: [
      {
        key: "Access-Control-Allow-Origin",
        value: process.env.NEXT_PUBLIC_APP_URL,
      },
    ],
  },
];
```

## 7. ì„±ëŠ¥ ìµœì í™”

### 7.1 ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

- **ì¸ë±ìŠ¤ ì„¤ì •**: ìì£¼ ì¡°íšŒë˜ëŠ” í•„ë“œì— ì¸ë±ìŠ¤ ì¶”ê°€
- **ì¿¼ë¦¬ ìµœì í™”**: Prisma include/selectë¡œ í•„ìš”í•œ ë°ì´í„°ë§Œ ì¡°íšŒ
- **Connection Pooling**: Prisma ìë™ ì—°ê²° í’€ ê´€ë¦¬

### 7.2 í”„ë¡ íŠ¸ì—”ë“œ ìµœì í™”

- **Code Splitting**: Next.js ìë™ ì½”ë“œ ë¶„í• 
- **Image Optimization**: Next.js Image ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
- **Lazy Loading**: ë™ì  import() í™œìš©
- **ìºì‹±**: SWR ë˜ëŠ” React Query ë„ì… ê³ ë ¤

### 7.3 API ìµœì í™”

- **Rate Limiting**: ê³¼ë„í•œ ìš”ì²­ ë°©ì§€ (êµ¬í˜„ ì˜ˆì •)
- **Pagination**: ëŒ€ëŸ‰ ë°ì´í„° í˜ì´ì§€ë„¤ì´ì…˜
- **Response Caching**: ì •ì  ë°ì´í„° ìºì‹±

## 8. ê°œë°œ í™˜ê²½ ì„¤ì •

### 8.1 í•„ìˆ˜ ë„êµ¬

```bash
# í•„ìˆ˜ ì„¤ì¹˜ í•­ëª©
- Node.js 18.x ì´ìƒ
- yarn
- PostgreSQL (ë¡œì»¬) ë˜ëŠ” Supabase ê³„ì •
- ngrok (OAuth ê°œë°œìš©, ì¸ìŠ¤íƒ€ê·¸ë¨ ê´€ë ¨ í…ŒìŠ¤íŠ¸ì‹œ ì‚¬ìš©)
```

### 8.3 ê°œë°œ ì„œë²„ ì‹¤í–‰

```bash
# 1. ì˜ì¡´ì„± ì„¤ì¹˜
yarn install

# 2. Prisma í´ë¼ì´ì–¸íŠ¸ ìƒì„±
yarn prisma generate

# 3. DB ìŠ¤í‚¤ë§ˆ ë™ê¸°í™”
yarn prisma db push

# 4. ê°œë°œ ì„œë²„ ì‹¤í–‰
yarn dev

# 5. ngrok í„°ë„ë§ (ë³„ë„ í„°ë¯¸ë„)
ngrok http 3001
```

## 9. ë°°í¬ ì•„í‚¤í…ì²˜

### 9.1 ë°°í¬ í™˜ê²½ (ì˜ˆì •)

```
- Platform: Vercel / AWS EC2
- Database: AWS RDS (PostgreSQL)
- Storage: Supabase Storage
```

### 9.2 í™˜ê²½ë³„ ì„¤ì •

```
Development:
â”œâ”€â”€ Local PostgreSQL
â””â”€â”€ Hot Reload í™œì„±

Production:
â”œâ”€â”€ AWS RDS
â”œâ”€â”€ ì‹¤ì œ ë„ë©”ì¸ HTTPS
â”œâ”€â”€ í™˜ê²½ ë³€ìˆ˜ ë³´ì•ˆ ê´€ë¦¬

```

## 10. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### 10.1 ë¡œê¹… ì „ëµ

```javascript
// API Route ë¡œê¹… ì˜ˆì‹œ
console.log(`[${new Date().toISOString()}] ${method} ${url}`);
console.error(`[ERROR] ${error.message}`, error.stack);
```

### 10.2 ëª¨ë‹ˆí„°ë§ ë„êµ¬ (ë„ì… ì˜ˆì •)

- **Sentry**: ì—ëŸ¬ íŠ¸ë˜í‚¹
- **Vercel Analytics**: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- **Supabase Dashboard**: DB ë° Auth ëª¨ë‹ˆí„°ë§

_ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2026-01-08_
